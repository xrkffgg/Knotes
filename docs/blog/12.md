# 12. Canvaså›¾ç‰‡å¤„ç†ä¹‹é»‘ç™½ã€åå‘ï¼ˆé™„æ¼”ç¤ºåŠæºç ï¼‰
## 1 å‰ è¨€
### 1.1 é¢„è§ˆå›¾

![](https://user-gold-cdn.xitu.io/2019/8/15/16c9458036ee5816?w=692&h=440&f=gif&s=1093257)

## 2 å® ç°
æœ¬ä¾‹ä½¿ç”¨ï¼š
- Vue
- element-ui

### 2.1 ç”» å›¾
```
<!--canvas å®šä¹‰-->
<canvas id="canvas01" width="400" height="400"></canvas>
```

```
//  vue ç”Ÿå‘½å‘¨æœŸ
mounted(){
    this.drawCanvas()
},
```
```
drawCanvas(){
    var cav = document.getElementById('canvas01')
    var ctx = cav.getContext('2d')
    var img = new Image()
    img.crossOrigin = 'anonymous'
    // è¿™é‡Œçš„ url æŒ‡å‘äº† æˆ‘ GitHub å¤´åƒåœ°å€
    img.src = this.url + '?time=' + new Date().getTime()
    img.onload = () =>{
        if(img.complete){
            ctx.drawImage(img,0,0,img.width,img.height)
            setTimeout(() =>{
                // ä¿å­˜åŸå§‹åƒç´ ä¿¡æ¯
                this.imagePixels = [...ctx.getImageData(0,0,cav.width,cav.height).data]
            },1)
        }
    }
}
```
**æ³¨æ„ï¼š**
- canvas é¡»è®¾ç½® `width` `height`
- è‹¥ä½ çš„é¡¹ç›®ä¸­ï¼Œæœ‰å¤šä¸ª `canvas` ç”»å›¾ï¼Œæ³¨æ„ `id` å®šä¹‰è¦ä¸åŒ
- ç”Ÿå‘½é’©å­ä¸èƒ½ä½¿ç”¨ `created()`
- `img.crossOrigin` `img.src ?time=` æ˜¯ä¸ºäº†è§£å†³ å›¾ç‰‡è·¨åŸŸçš„é—®é¢˜
- ä¸ºä¸å½±å“å›¾ç‰‡æ¸²æŸ“ï¼Œä¿å­˜åƒç´ ä¿¡æ¯çš„åŠ¨ä½œï¼Œæ”¾åœ¨å¼‚æ­¥ä¸­æ‰§è¡Œ

> è‹¥åªæ˜¯ç”¨ `canvas` ç”»å›¾ï¼Œåˆ™ä¸å­˜åœ¨è·¨åŸŸé—®é¢˜ï¼Œè¿™é‡Œçš„å®šä¹‰æ˜¯å› ä¸ºè¦è·å–åƒç´ ä¿¡æ¯

### 2.2 é»‘ ç™½
```
var cav = document.getElementById('canvas01')
var ctx = cav.getContext('2d')
let imageData = ctx.getImageData(0,0,cav.width,cav.height)
let pixels = imageData.data

// å¤„ç†åƒç´ ç‚¹
for (let i=0; i<pixels.length; i+=4){
    let r = pixels[i]
    let g = pixels[i+1]
    let b = pixels[i+2]

    // ç°è‰²
    let gray = parseInt((r+g+b)/3)
    imageData.data[i] = gray
    imageData.data[i+1] = gray
    imageData.data[i+2] = gray
}
// é‡æ–°ç”»å›¾
ctx.putImageData(imageData, 0,0)
```

### 2.3 å…¶ä»–
**å½©è‰²ï¼š** ç”¨ç›¸åŒçš„æ–¹æ³•ï¼Œå°†ä¹‹å‰ä¿å­˜çš„åŸå§‹åƒç´ æ¢å¤å›å»

**åå‘ï¼š** 255 - åŸå€¼

> è¿˜æœ‰å¾ˆå¤šçš„å›¾ç‰‡å¤„ç†ï¼Œæ˜¯å°†å›¾ç‰‡çš„ `r` `g` `b` è¿›è¡Œä¸åŒå¤„ç†

## 3 å è®°
**æ„Ÿè°¢æ”¯æŒã€‚è‹¥ä¸è¶³ä¹‹å¤„ï¼Œæ¬¢è¿å¤§å®¶æŒ‡å‡ºï¼Œå…±å‹‰ã€‚**

**å¦‚æœè§‰å¾—ä¸é”™ï¼Œè®°å¾— ç‚¹èµï¼Œè°¢è°¢å¤§å®¶** ğŸ˜‚ 

> **æ¬¢è¿å…³æ³¨ æˆ‘çš„ï¼š** [GitHub](https://github.com/xrkffgg) [æ˜ é‡‘](https://juejin.im/user/59c369496fb9a00a4843a3e2) [ç®€ ä¹¦](https://www.jianshu.com/u/4ca4daac5890)

### 3.1 æ¼”ç¤ºåœ°å€
https://xrkffgg.github.io/Kvue/#/Canvas/001

### 3.2 æº ç 
https://github.com/xrkffgg/Kvue/blob/master/src/components/canvasCom/001.vue